define(["@jupyter-widgets/base"],(t=>(()=>{var e={886:(t,e,i)=>{"use strict";function s(t){return new Promise((e=>setTimeout(e,t)))}function a(t){return t*Math.PI/180}function n(t,e,i){return{x:i.x+e*Math.cos(a(t)),y:i.y+e*Math.sin(a(t))}}i.r(e),i.d(e,{TurtleCanvasModel:()=>l,TurtleCanvasView:()=>d});class r{#rows;#columns;#image;#frameWidth;#frameHeight;#currentFrame;#maxFrame;#canvas;#spriteScale;constructor(t,e,i,s,a){this.#rows=t,this.#columns=e,this.#image=i,this.#frameWidth=i.width/e,this.#frameHeight=i.height/t,this.#currentFrame=0,this.#maxFrame=e*t-1,this.#canvas=s,this.#spriteScale={width:this.frameWidth*a,height:this.frameHeight*a},this.#loadImage(i,a)}#loadImage(t,e){t.onload=()=>{this.#image=t,this.#frameWidth=t.width/this.#columns,this.#frameHeight=t.height/this.#rows,this.#spriteScale={width:this.#frameWidth*e,height:this.#frameHeight*e},this.#currentFrame=0},this.#reloadImage()}#reloadImage(){this.#image.complete&&0!==this.#image.naturalHeight&&this.#image.onload()}setCanvas(t){this.#canvas=t,this.#reloadImage()}async run(t){if(!this.#canvas)return;this.#currentFrame++,this.#currentFrame>this.#maxFrame&&(this.#currentFrame=0);let e=this.#currentFrame%this.#columns,i=Math.floor(this.#currentFrame/this.#columns);this.#canvas.drawImage(this.#image,e*this.#frameWidth,i*this.#frameHeight,this.#frameWidth,this.#frameHeight,t.x-this.#getCenterOffset().width,t.y-this.#getCenterOffset().height,this.#spriteScale.width,this.#spriteScale.height),await s(1e3/this.#maxFrame)}#getCenterOffset(){return{width:this.#spriteScale.width/2,height:this.#spriteScale.height/2}}}class h{#position;#angle;#speed;#actions;#moving;#width;#height;#color;#penUp;#invisibleColor;#backgroundCanvas;#foregroundCanvas;#idleSprite;#moveSprite;#spritePosition;constructor(t,e,i,s,a,n){this.#position={x:0,y:0},this.#angle=0,this.#speed=1,this.#moving=!1,this.#penUp=!1,this.#width=a,this.#height=n,this.#color="black",this.#invisibleColor="rgb(0, 0, 0, 0)",this.#backgroundCanvas=t,this.#foregroundCanvas=e,this.#idleSprite=i,this.#moveSprite=s,this.#spritePosition={x:0,y:0},this.#actions=[],this.init=this.init.bind(this)}async init(){let t=33-1e3*(await this.#update()+await this.#draw());t>0&&await s(33-t)}async#update(){let t=performance.now();return this.#actions.length&&(await this[this.#actions[0].action](...this.#actions[0].parameters),this.#actions.splice(0,1)),performance.now()-t}get angle(){return this.#angle}forward(t){this.#actions.push({action:"forwardAction",parameters:[t]})}async forwardAction(t){this.#backgroundCanvas.beginPath(),this.#moving=!0,t=parseInt(t);let e=null;for(;t;)e=Math.abs(t)<this.#speed/10*66?t:t>0?Math.round(this.#speed/10*66):-1*Math.round(this.#speed/10*66),this.#backgroundCanvas.moveTo(this.#position.x,this.#position.y),this.#position=n(this.#angle,e,this.#position),this.#spritePosition.x+=e,this.#backgroundCanvas.lineTo(this.#position.x,this.#position.y),this.#backgroundCanvas.stroke(),this.#draw(),t-=e,await s(66);this.#moving=!1}backward(t){this.#actions.push({action:"forwardAction",parameters:[-t]})}setLineColor(t){this.#actions.push({action:"setLineColorAction",parameters:[t]})}async setLineColorAction(t){this.#color=t,this.#penUp||(this.#backgroundCanvas.beginPath(),this.#backgroundCanvas.strokeStyle=t)}circle(t){this.#actions.push({action:"circleAction",parameters:[t]})}async circleAction(t){this.#backgroundCanvas.beginPath(),this.#backgroundCanvas.arc(this.#position.x,this.#position.y,t,0,2*Math.PI)}rectangle(t,e){this.#actions.push({action:"rectangleAction",parameters:[t,e]})}async rectangleAction(t,e){this.#backgroundCanvas.rect(this.#position.x,this.#position.y,t,e)}speed(t){if(!t)return this.#speed;this.#actions.push({action:"speedAction",parameters:[t]})}async speedAction(t){this.#speed=t}async clear(){this.#foregroundCanvas.fillStyle="rgba(0,0,0,1)",this.#foregroundCanvas.globalCompositeOperation="destination-out"}turtleCommandsList(t){this.#actions=t}right(t){this.#actions.push({action:"rightAction",parameters:[t]})}async rightAction(t){for(this.#angle+=parseInt(t);this.angle>=360;)this.#angle=this.#angle-360;this.#rotateForegroundCanvas("right",t)}left(t){this.#actions.push({action:"leftAction",parameters:[t]})}async leftAction(t){for(this.#angle-=parseFloat(t);this.angle<0;)this.#angle=this.#angle+360;this.#rotateForegroundCanvas("left",t)}#rotateForegroundCanvas(t,e){"left"==t&&(e*=-1),this.#foregroundCanvas.translate(this.#spritePosition.x,this.#spritePosition.y),this.#foregroundCanvas.rotate(a(e)),this.#foregroundCanvas.translate(-this.#spritePosition.x,-this.#spritePosition.y)}setPosition(t,e){this.#actions.push({action:"setPositionAction",parameters:[t,e]})}async setPositionAction(t,e){t=parseFloat(t),e=parseFloat(e),e*=-1,this.#backgroundCanvas.moveTo(t,e),this.#position={x:t,y:e},this.#foregroundCanvas.setTransform(1,0,0,1,.5*this.#width,.5*this.#height),this.#spritePosition={x:t,y:e},this.#rotateForegroundCanvas("",this.#angle)}async getPosition(){for(;0!==this.#actions.length;)await s(33);return this.#position}penUp(){this.#actions.push({action:"penUpAction",parameters:[]})}async penUpAction(){this.#penUp=!0,this.#backgroundCanvas.strokeStyle=this.#invisibleColor,this.#backgroundCanvas.beginPath()}penDown(){this.#actions.push({action:"penDownAction",parameters:[]})}async penDownAction(){this.#penUp=!1,this.#backgroundCanvas.strokeStyle=this.color,this.#backgroundCanvas.beginPath(),this.#backgroundCanvas.strokeStyle=this.#color}async#draw(){var t=performance.now();return this.#backgroundCanvas.stroke(),this.#foregroundCanvas.clearRect(this.#spritePosition.x-this.#width,this.#spritePosition.y-this.#height,3*this.#width,3*this.#height),this.#moving,await this.#moveSprite.run(this.#spritePosition),performance.now()-t}}class o extends HTMLElement{#backgroundCanvas;#parentDiv;#forwardCanvas;static get observedAttributes(){return["width","height"]}constructor(){super(),this.#parentDiv=document.createElement("div"),this.#backgroundCanvas=document.createElement("canvas"),this.#parentDiv.appendChild(this.#backgroundCanvas)}get width(){return this.getAttribute("width")}set width(t){this.setAttribute("width",t)}get height(){return this.getAttribute("height")}set height(t){this.setAttribute("height",t)}get canvasClass(){return this.getAttribute("canvas-class")}set canvasClass(t){this.setAttribute("canvas-class",t)}connectedCallback(){this.width||(this.width=300),this.height||(this.height=300),this.canvasClass||(this.canvasClass="border: solid 1px black;"),this.initializeCanvas()}initializeCanvas(t=document.body){this.#backgroundCanvas.width=this.width,this.#backgroundCanvas.height=this.height,this.#backgroundCanvas.style="position: absolute !important",this.#backgroundCanvas.className=this.canvasClass,this.#parentDiv.style="position: relative;",this.#backgroundCanvas.getContext("2d").translate(.5*this.#backgroundCanvas.width,.5*this.#backgroundCanvas.height),t.appendChild(this.#parentDiv)}attributeChangedCallback(t,e,i){if(e!==i)switch(t){case"width":this.width=i;break;case"height":this.height=i;break;case"canvas-class":this.canvasClass=i}}async#update(t){for(;;)await t.init()}#buildForwardCanvas(){let t=document.createElement("canvas");t.style="position: absolute;",this.#parentDiv.appendChild(t);let e=t.getContext("2d");return t.width=this.width,t.height=this.height,e.translate(.5*t.width,.5*t.height),e}#idleSprite(t,e){return(t=new Image).src="js/dist/23d3dc43a7ebe54f7dcbf2bc658de693.png",new r(1,10,t,e,.2)}#moveSprite(t,e){return(t=new Image).src="js/dist/97466b07c2424184308f22f5928448ec.png",new r(1,8,t,e,.2)}buildSprite(t,e,i,s){return new r(t,e,i,null,s)}getTurtle(t=null,e=null){let i=this.#buildForwardCanvas();t&&t.setCanvas(i),e&&e.setCanvas(i);let s=new h(this.#backgroundCanvas.getContext("2d"),i,null===t?this.#idleSprite(t,i):t,null===e?this.#moveSprite(e,i):e,this.width,this.height);return this.#update(s),s}getImageData(t,e,i,s){return this.#backgroundCanvas.getContext("2d").getImageData(t,e,i,s)}}customElements.define("x-turtle",o);var c=i(612);class l extends c.DOMWidgetModel{defaults(){return{...super.defaults(),_model_name:"TurtleCanvasModel",_view_name:"TurtleCanvasView",_model_module:"pyturtle",_view_module:"pyturtle",_model_module_version:"0.1.0",_view_module_version:"0.1.0"}}}class d extends c.DOMWidgetView{render(){this.turtles={},this.create_canvas(),this.model.on("change:command",this.execute,this),this.model.on("change:last_turtle",this.create_turtle,this)}create_turtle(){const t=this.model.get("last_turtle");Number.isInteger(t.id)&&(this.turtles[t.id]=this.canvas.createTurtle())}create_canvas(){let t=document.createElement("canvas");this.canvas=new o,this.canvas.width=this.model.get("width"),this.canvas.height=this.model.get("height"),t.setAttribute("width",this.canvas.width),t.setAttribute("height",this.canvas.height),this.canvas.canvasStyle=this.model.get("canvas_style"),this.canvas.spriteScale=this.model.get("sprite_scale"),this.canvas.initializeCanvas(this.el),this.el.appendChild(t),this.set_canvas()}set_canvas(){this.model.set("canvas",{element:this.canvas}),this.model.save_changes()}set_turtle(){this.model.set("turtle",{element:this.turtle}),this.model.save_changes()}get_canvas(){let t=this.model.get("canvas");if(t)return t.element}get_turtle(){let t=this.model.get("turtle");if(t)return t.element}execute(){this.command=this.model.get("command"),this.command.function_name&&(this.run(),this.command={})}run(){let t=this.command.turtle_id,e=this.turtles[t];e&&e[this.command.function_name](...this.command.args)}}},568:(t,e,i)=>{t.exports=i(886),t.exports.version=i(306).version},306:t=>{"use strict";t.exports={version:"0.1.0"}},612:e=>{"use strict";e.exports=t}},i={};function s(t){var a=i[t];if(void 0!==a)return a.exports;var n=i[t]={exports:{}};return e[t](n,n.exports,s),n.exports}return s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s(568)})()));